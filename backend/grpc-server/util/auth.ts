import { Metadata } from "@grpc/grpc-js"; import { ERR } from "./errors.js"; export function requireBearer(metadata: Metadata): string { const a = metadata.get("authorization")[0]; if (!a || typeof a !== "string" || !a.toLowerCase().startsWith("bearer ")) throw ERR.unauthenticated("missing or invalid authorization header"); const t=a.slice(7); if(!t) throw ERR.unauthenticated("empty bearer token"); return "subject:"+t;} export function getRequestId(metadata: Metadata): string|undefined{const rid=metadata.get("x-request-id")[0]; return typeof rid==="string"?rid:undefined;}